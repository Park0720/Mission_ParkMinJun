# Title: [3Week] 박민준

---
## 미션 요구사항 분석 & 체크리스트

---
### 필수미션 - 네이버클라우드플랫폼을 통한 배포(도메인 없이, IP로 접속)

---

### 배경
- 네이버클라우드플랫폼을 이용합니다.

- 강사의 가이드영상대로 진행하시면 됩니다.

- 나머지 미션을 수행하신 후 마지막에 진행하시면 됩니다.
---
### 목표

---
- [ ] https://서버IP:포트/ 형태로 접속이 가능

- [ ] 운영서버에서는 각종 소셜로그인, 인스타 아이디 연결이 안되어도 됩니다.

---
### 필수미션 - 호감표시/호감사유변경 후, 개별 호감표시건에 대해서, 3시간 동안은 호감취소와 호감사유변경을 할 수 없도록 작업

---
### 배경

---
- 현재 UI에서는 이 요구사항에 대한 작업이 완료되었습니다.

- 백엔드 쪽에서 체크하는 로직만 추가하면 됩니다.
---
### 목표

---
- [x] 호감표시를 한 후 개별호감표시건에 대해서, 3시간 동안은 호감취소와 호감사유변경을 할 수 없도록 작업

- [x] 호감사유변경을 한 후 개별호감표시건에 대해서, 3시간 동안은 호감취소와 호감사유변경을 할 수 없도록 작업
---
### 선택미션 - 알림기능 구현

---
### 배경

---
- 현재 알림페이지의 UI 레이아웃은 구현이 된 상태입니다.

- 이를 기반으로 나머지 구현을 이어나가시면 됩니다.

- 페이징 처리는 하지 않아도 됩니다.
---
### 목표

---
- [x] 호감표시를 받았거나, 본인에 대한 호감사유가 변경된 경우에 알림페이지에서 확인이 가능하도록 해주세요.

- [ ] 각각의 알림은 생성시에 readDate 가 null 이고, 사용자가 알림을 읽으면 readDate 가 현재날짜 로 세팅되어야 합니다.


## 3주차 미션 요약

---

### 접근 방법

---
**네이버클라우드플랫폼을 통한 배포(도메인 없이, IP로 접속)**

---
접근 방법


---
**호감표시/호감사유변경 후, 개별 호감표시건에 대해서, 3시간 동안은 호감취소와 호감사유변경을 할 수 없도록 작업**

---
 - `modify`, `delete` 메서드를 진행할 때, 혹은 `like` 메서드를 통해 호감사유변경을 시도할 경우에도 `modifyDate`를 기준으로 
3시간이 지나지 않았으면 해당 버튼을 눌렀을 때 오류 반환하도록 출력
 - 오류메세지에 남은 시간을 출력하도록 `calDiffTime` 메서드 생성
 - 3시간은 변경될 수 있는 사항이라 `.yml`파일에서 따로 설정
 - UI에서 남은 시간 나오도록 변경

---
**알림기능 구현**

---
- 이벤트 발생 시에 해당 알림을 생성하면 될 것 같은데 어떻게 시작해야할 지 감이 안 잡힘
- `LikeablePersonService` 에서 `like`, `modify` 메서드가 실행될 때 `Notification` 엔티티 생성 하도록 함
- `Notification` 엔티티에서 성별, 호감사유 구분할 수 있도록 변경
- `Like`시에 발생하는 알림 기본 템플릿 만듬
- `Modify`시에 발생하는 알림 기본 템플릿 만듬
- `Notification` 엔티티에 따라 `Like`, `Modify` 시에 성별, 호감사유, 언제 등록했는 지 나오도록 `notification\list.html` 변경
- 알림 온 시간이 10분 전 이하일 경우 불꽃모양 아이콘 나오게 함

---
### 특이사항

---
**네이버클라우드플랫폼을 통한 배포(도메인 없이, IP로 접속)**

---
- 특이사항

---
**호감표시/호감사유변경 후, 개별 호감표시건에 대해서, 3시간 동안은 호감취소와 호감사유변경을 할 수 없도록 작업**

---
- 페이지에서 변경을 할 경우 `modifyDate`와 `modifyUnlockDate`가 잘 변경되는데 테스트를 진행할 경우 `modifyUnlockDate`가 
3시간 뒤로 변경되지 않는다.
- ```LikeablePersonServiceTests.java```파일 TestCase 8의 
```TestUt.setFieldValue(likeablePersonToBts, "modifyUnlockDate", LocalDateTime.now().minusSeconds(1));```에서
```minusSeconds(-1)```로 되어있어서 `modify`가 진행되지 않아 테스트상황에선 `modifyUnlockDate`가 갱신되지 않음
-> 해당 문제 해결
---
**알림기능 구현**

---
- 이벤트 리스너를 통해서 구현해야할 것 같은데 구현 방법이 도저히 떠오르지 않아서 `LikeablePersonService`에서 `like`와 `modify` 진행 시에 엔티티 생성함
---
### Refactoring

---
- [ ] 리팩토링  
---
**코드 리뷰 후**

---

- [ ] 리팩토링

